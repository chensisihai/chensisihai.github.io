---
layout: post
title:  "web前端总结之性能优化（五）"
categories: 性能 调试
tags:  调试 性能 优化 js css 
---

* content
{:toc}


>本文是对慕课网[Yahoo军规](http://www.imooc.com/learn/50)课程并结合360doc网站的文章[yahoo
 35条前端优化建议](http://www.360doc.com/content/14/0325/14/15727046_363598248.shtml)总结的项目中经常使用的优化规则，通过学习我把这些性能优化规则分为2部分：一部分是前端在做项目的过程中需要注意的；一部分是涉及后台需要处理的。




## 尽可能的减少http请求

什么是减少http请求？

从客户端到服务器端的请求信息，也就是打开网页时所看到的的文字、图片、多媒体等内容都是从服务器获取的，每一个内容的获取，就是一个http请求。

80%的响应时间花在下载网页内容(images, stylesheets, javascripts, scripts, flash等)。减少请求次数是缩短响应时间的关键！可以通过简化页面设计来减少请求次数，但页面内容较多可以采用以下技巧。

1、合并多个css文件
2、合并多个js文件
3、合并图片，使用css sprites把多个图片拼成一张图，通过background属性的position进行定位。


## 将css文件放到最上面


把样式表放在文档底部的问题是在包括IE在内的很多浏览器中会中止内容的有序呈现。浏览器中止呈现是为了避免样式改变引起的页面元素重绘，导致页面空白，影响用户体验。所以应将css文件放到<head>标签内，会加快页面的下载速度


## 将script放在页面最下面

DOM加载顺序： 依次读取html标签、head标签、 meta、 title、  style、 link、 script、  body、 div、 img 
读取完成之后，页面初始化完毕。 

如果js文件中有死循环，则script之后的代码就执行不到了 ，时间长了会导致浏览器崩溃。再就是页面会长时间空白，让用户一直等待。所以应将js文件放到body结束标签前面


## 避免在css中使用expressions

css expressions 俗称css表达式：把css属性和js表达式关联起来，是动态设置css属性的强大（但危险）方法。

如例子：ul a {width: expression(this.offsetWidth > 750 ? function1() : function2() );} 

表达式的问题在于它的计算频率要比我们想象中的多，当页面显示和缩放时， 页面滚动时，移动鼠标时，都会重新计算一次表达式。给css表达式增加一个计数器可以跟踪表达式的计算频率。轻松移动鼠标都能达到10000次以上的计算量，严重影响页面性能，应避免使用。

## 把js和css放到外部文件中

写在外部：
好处：
1. 提高了js和css的复用性
2. 减小页面体积
3. 提高了js和css的可维护性

缺点：增加了请求数（可通过缓存解决）

写在页面内：
好处：
1. 减少页面请求
2. 提升页面渲染速度

缺点：不利于维护、复用

在项目中一般会把js和css放到外部文件中，有时也要根据项目的实际情况使用，当：
1. 某个脚本或样式：
2. 只应用与一个页面
3. 不经常被访问到
4. 脚本和样式很少

此时应该将css和js写在页面内。

## 压缩js和css文件

去除代码中不必要的字符减少文件大小，从而节省下载时间。 压缩时，所有的注释、空格、换行、tab缩进都要去掉。

js压缩工具有JSMin和YUI Compressor
css压缩工具YUI Compressor 

## 移除重复的脚本

在同一个页面中重复引用js文件会影响页面性能，除此之外，多次运算脚本会出现错误同时也会浪费时间。

## 减少DOM访问

使用js访问DOM会比较慢，应该缓存已经访问过的有关元素，避免使用js来修改布局。


## 不要在html文件中缩放图像

不要在html中通过img的width和height设置宽高，如果设置了100x100，图片就应该是100x100像素的而不是500x500像素的图片缩小使用。

## 避免空的图像来源

如： 

```html
<img src="" />
```

```js
 var img = new Image(); img.src="";
```


## 使用CDN（内容分发网络）

提高下载速度还可以通过CDN(内容分发网络)来提升。CDN通过部署在不同地区的服务器来提高客户的下载速度。

## 启用Gzip压缩

把文件放到服务器进行压缩，然后再传输
，传输完后，浏览器会对传输内容解压缩再执行。
压缩将体积变小，提升下载速度。

## 避免重定向

用户想访问的页面A被重新指向了页面B

重定向状态吗：
1、301：永久重定向 
用户请求的页面，被移动到了另外的位置

2、302 ：临时重定向

用户请求的页面被找到了，但不在原始位置

为什么避免重定向？

增加了浏览器到服务器的往返次数

## 添加Expire/Cache-Control头

这条规则分为两个方面，

对于静态内容添加Expires，将静态内容设为永不过期，或者很长时间以后。在IIS中设置Expires可以看Configure the HTTP Expires Response Header (IIS 7)。
对于动态内容应用合适的Cache-Control，让浏览器根据条件来发送请求。关于asp.net的caching，可以看asp.net cache feature和asp.net caching best practices。




